# 쿠키&세션

## 사용하는 이유

1. HTTP의 **비연결성**

   클라이언트가 서버에 `요청(Request)`을 보내고 `응답(Response)`을 받으면 서버는 접속을 끊는다

2. HTTP의 **비상태성**

   클라이언트와 서버의 연결이 끝나면 상태 정보가 유지되지 않는다

   ex) 로그인을 한 뒤 다른 페이지로 이동했다가 돌아오면 로그인 정보가 유지되지 않는다

--> 정보를 유지하기 위해 사용한다



## 쿠키

### 특징

- 만료 기한이 있는 키-값 저장소

  - 클라이언트 또는 서버에서 만료기한 등을 정할 수 있는데 보통 서버에서 만료기한을 정함

- 4KB까지 데이터를 저장할 수 있다

- 클라이언트 로컬에 저장된다

  - 보안에 취약
  - 브라우저를 종료해도 계속 남아있다

  

### 동작 순서

![image](https://github.com/mindot7/TIL/assets/97648258/d5cdedd0-2885-4404-b23c-b5dcc48c1f75)

1. 클라이언트가 페이지를 요청한다. (사용자가 웹사이트 접근)
2. 웹 서버는 쿠키를 생성한다.
3. 생성한 쿠키에 정보를 담아 HTTP 화면을 돌려줄 때 같이 클라이언트에게 돌려준다.
4. 넘겨 받은 쿠키는 클라이언트가 가지고 있다가(로컬 PC에 저장) 다시 서버에 요청할 때 요청과 함께 쿠키를 전송한다.
5. 동일 사이트 재방문시 클라이언트의 PC에 해당 쿠키가 있는 경우, 요청 페이지와 함께 쿠키를 전송한다.



### 사용 예시

- 방문했던 사이트에 다시 방문했을 때 아이디/비밀번호 자동 입력 및 로그인
- 팝업창을 통해 '오늘 이 창을 다시 보지 않기' 체크
- 쇼핑몰 장바구니 기능
- 최근 검색한 상품들을 광고에서 추천





## 세션

### 특징

- 만료 기한이 없는 키-값 저장소

- 세션은 일정 시간동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지시키는 기술

  == 웹 서버에 접속해 있는 상태를 하나의 단위(세션)로 본다

- 서버 측에서 관리

- 클라이언트에게 고유 ID를 부여하고 이에 맞게 서비스를 제공하기 때문에 보안면에서 쿠키보다 우수

- 사용자가 많아질 수록 서버 메모리 차지 --> 성능 저하의 요인이 될 수 있다



### 동작 순서

![image](https://github.com/mindot7/TIL/assets/97648258/d53c2072-f1e5-4cc5-b32d-a894e80eba71)

1. 클라이언트가 서버에 접속 시 세션 ID를 발급 받는다
2. 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장하고 가지고 있는다
3. 클라리언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 같이 서버에 전달해서 요청한다
4. 서버는 세션 ID를 전달 받아서 별다른 작업없이 세션 ID로 세션에 있는 클라언트 정보를 가져와서 사용한다
5. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답한다



### 사용 예

- 로그인 유지

  화면을 이동해도 로그아웃을 하기 전까지 유지됨





## 차이점

|                           | **쿠키(Cookie)**                                             | **세션(Session)**                     |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------- |
| **저장 위치**             | 클라이언트(=접속자 PC)의 메모리 또는 파일                    | 웹 서버                               |
| **저장 형식**             | text                                                         | Object                                |
| **만료 시점**             | 쿠키 저장시 설정 (브라우저가 종료되도, 만료시점이 지나지 않으면 자동삭제되지 않음) | 브라우저 종료시 삭제 (기간 지정 가능) |
| **사용하는 자원(리소스)** | 클라이언트 리소스                                            | 웹 서버 리소스                        |
| **용량 제한**             | 총 300개 하나의 도메인 당 20개 하나의 쿠키 당 4KB(=4096byte) | 서버가 허용하는 한 용량제한 없음.     |
| **속도**                  | 세션보다 빠름                                                | 쿠키보다 느림                         |
| **보안**                  | 세션보다 안좋음                                              | 쿠키보다 좋음                         |



#### 속도

- 쿠키에 정보가 있기 때문에 서버에 요청시 헤더를 바로 참조하면 되므로 속도에서는 세션보다 빠르다.
- 세션은 제공받은 세션 ID를 이용해서 서버에서 다시 데이터를 참조해야 하므로 속도가 비교적 느릴 수 있다.

#### 보안

- 쿠키는 클라이언트 로컬에 저장되기도 하고 특히 파일로 저장되는 경우 탈취, 변조될 위험이 있고, `Request/Response`에서 스나이핑 당할 위험이 있어 보안이 비교적 취약하다.
- 세션은 클라이언트 정보 자체는 서버에 저장되어 있으므로 비교적 안전하다.





*참고 자료*

- 사진 https://sirong.tistory.com/100
- https://velog.io/@sorzzzzy/Code.presso-%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98%EA%B0%9C%EB%85%90%EA%B3%BC-%ED%99%9C%EC%9A%A9-%EC%98%88%EC%8B%9C%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90
- https://hahahoho5915.tistory.com/32