# 쿠키(Cookie)와 세션(Session)

### 왜 필요할까? : HTTP 프로토콜의 특징

**비연결성(Connectionless)**

HTTP 프로토콜의 가장 큰 특징은 비연결성으로, **서버와 클라이언트가 데이터를 주고 받은 다음에는 서로의 상태를 기억하지 않는다**.

**상태 없음 (Stateless)**

커넥션을 끊는 순간 클라이언트/서버 간 통신이 끝나며, **상태 정보는 유지하지 않는다.** 즉 클라이언트가 보낸 요청에는 어떤 상태를 가지고 있지 않으며, 이를 상태없음이라고 한다.



이 두 가지 특징을 보완하기 위해 쿠키와 세션을 사용한다.



## 쿠키

사용자가 어떠한 웹 사이트를 방문할 경우, 그 사이트가 사용하고 있는 서버에서 **사용자의 컴퓨터에 저장하는 작은 기록 정보 파일**이다.

클라이언트의 상태 정보를 클라이언트의 로컬 PC에 저장하였다가, 필요시 정보를 참조하거나 재사용할 수 있다.



### 특징

1. **이름, 값, 만료일 (저장 기간 설정), 경로 정보**로 구성되어 있다.
2. 클라이언트에 **총 300개의 쿠키를 저장**할 수 있다.
3. 하나의 **도메인 당 20개의 쿠키**를 가질 수 있다.
4. 하나의 쿠키는 **4KB (=4096byte)** 까지 저장 가능하다.
5. 제 3자의 조회가 가능하기 때문에, 민감 정보 저장에 적합하지 않다.
6. **세션 쿠키(Session Cookie)** 와 **지속 쿠키(Persistent Cookie)**
   1.  세션 쿠키: **만료 날짜/시간을 정해두지 않으면**, '메모리에 있는 동안' 계속 유효하다고 판단되어 세션 쿠키에 저장됨. 브라우저가 종료되면 쿠키 소멸.
   2. 지속 쿠키: **만료 날짜/시간을 정해두면** 해당 시기까지 유효하므로, 지속 쿠키에 저장됨. 브라우저가 종료되어도 쿠키가 남아 있음.



### 동작 순서

![cookie](https://hudi.blog/static/5a4ced996d1359318192025e6cc2c655/ca1dc/cookie.png)

1. 클라이언트가 페이지를 요청한다.
2. 웹 서버가 쿠키를 생성, 클라이언트에게 보내는 응답 헤더 중 `Set-Cookie`라는 헤더에 키와 값을 돌려준다.
3. 넘겨 받은 쿠키는 클라이언트가 가지고 있다가 (로컬 PC에 저장) 다시 서버를 요청할 때, 요청과 함께 쿠키를 전송한다.
4. 동일 사이트 재방문 시 클라이언트의 PC에 해당 쿠키가 있는 경우, 요청과 함께 쿠키를 전송, 서버는 그에 따른 응답을 전송한다.



## 세션

일정 시간동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지시키는 기술이다.

여기서 **일정 시간은 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터, 웹 브라우저를 종료하여 연결을 끝내는 시점**을 말한다.

즉, 방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고, 그것을 세션이라고 한다.



### 특징

1. 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되므로, 쿠키보다 비교적 보안이 좋다.
2. 저장 데이터에 제한이 없다. 
3. 각 클라이언트에 고유의 Session ID를 부여하며, 이를 통해 클라이언트를 구분하여 요구에 맞는 서비스를 제공한다.



### 동작 순서

![session](https://hudi.blog/static/b5affd77fa3033fe93b4c3c0b438fc25/3e3fe/session.png)

1. 클라이언트가 페이지를 요청한다.
2. 서버는 접근한 클라이언트의 쿠키를 확인하여, 클라이언트가 Session ID를 보냈는지 확인한다.
3. Session ID가 존재하지 않는다면, 서버는 Session ID를 생성해 쿠키에 담아 클라이언트에게 돌려준다.
4. 클라이언트는 받은 Session ID를 쿠키에 저장하고, 매 요청마다 Session ID를 쿠키에 실어 서버에 전송해 인증한다.



## 쿠키와 세션의 차이

1. 저장 위치

   - 쿠키: 클라이언트
   - 세션: 서버

2. 보안

   - 쿠키: 클라이언트에 저장되므로 보안에 취약.
   - 세션: 쿠키를 이용해 Session ID만 저장하고 이를 이용하여 서버에서 처리하므로, 비교적 보안성 좋음.

3. 라이프 사이클

   - 쿠키: 만료시간에 따라 브라우저를 종료해도 남아있을 수 있음.
   - 세션: 만료시간을 정할 수 있지만, 브라우저가 종료되면 만료시간에 상관 없이 삭제됨.

4. 속도

   - 쿠키: 클라이언트에 저장되어 있어, 서버 요청 시 빠름.
   - 세션: 실제 저장된 정보가 서버에 있으므로, 서버의 처리가 필요해 쿠키보다 느림. 


<hr/>

참고

https://jeong-pro.tistory.com/80

https://hudi.blog/cookie-and-session/

https://doooyeon.github.io/2018/09/10/cookie-and-session.html

https://hongong.hanbit.co.kr/%EC%99%84%EB%B2%BD-%EC%A0%95%EB%A6%AC-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0-%EC%BA%90%EC%8B%9C-%EA%B7%B8%EB%A6%AC%EA%B3%A0-cdn/
